generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
   url = env("DATABASE_URL")
}

/// =======================
/// features MODULE
/// =======================

model App {
  id          String  @id @default(uuid())
  key         String  @unique
  name        String
  description String
  icon        String
  route       String
  enabled     Boolean @default(true)
  order       Int
}

/// =======================
/// COMMENTARY MODULE
/// =======================

model Commentator {
  id      String @id @default(uuid())
  key     String @unique
  name    String
  style   String
  enabled Boolean @default(true)

  commentaries Commentary[]
  @@map("CommentaryCommentator")
}

model Commentary {
  id             String   @id @default(uuid())
  text           String
  featureKeys    String[]
  tags           String[]
  enabled        Boolean  @default(true)

  commentatorId  String
  commentator    Commentator @relation(fields: [commentatorId], references: [id])
}

/// =======================
/// Car MODULE
/// =======================

enum FuelType {
  PB95
  PB98
  DIESEL
  LPG
  ELECTRIC
}

model Car {
  id        String   @id @default(uuid())
  name      String
  year      Int
  isActive  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  soldAt    DateTime?

  mileageRecords MileageRecord[]
  fuelRecords    FuelRecord[]
  serviceRecords ServiceRecord[]
}

model MileageRecord {
  id        String   @id @default(uuid())
  carId    String
  mileageKm Int
  date      DateTime

  car Car @relation(fields: [carId], references: [id], onDelete: Cascade)
  @@map("CarMileageRecord")
}

model FuelRecord {
  id        String   @id @default(uuid())
  carId    String

  fuelType FuelType

  liters             Float
  totalPrice         Float
  mileageAtRefuelKm  Int
  date               DateTime

  car Car @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([carId, date])
  @@index([fuelType, date])
  @@map("CarFuelRecord")
}

model ServiceRecord {
  id        String   @id @default(uuid())
  carId    String

  description String
  cost        Float
  mileageKm   Int
  date        DateTime

  car Car @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([carId, date])
  @@map("CarServiceRecord")
}


